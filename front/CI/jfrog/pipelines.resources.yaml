resources:

# NPM PIPELINE
  - name: src_code_k8s_frontapp_npm
    type: GitRepo
    configuration:
      files:
        include: ^front\/.+
        exclude: ^front\/CI\/.+
#        exclude: ^back\/CI\/Docker\/.+
      gitProvider: yann_github
      path: cyan21/k8s-app
      branches:
        include: jfrog-ode

  # Build info for the published Npm App
  - name: bi_k8s_frontapp_npm
    type: BuildInfo
    configuration:
      sourceArtifactory: artifactory_eu
      buildName: k8s_frontapp_npm
      buildNumber: ${run_number}
  
  - name: bi_k8s_frontapp_npm_promoted_staging
    type: BuildInfo
    configuration:
      sourceArtifactory: artifactory_eu
      buildName: k8s_frontapp_npm
      buildNumber: '${run_number}'

  - name: pb_k8s_frontapp_js
    type: PropertyBag
    configuration:
      biNumber: XXX

# DOCKER PIPELINE
  - name: src_dockerfile_k8s_frontapp_npm
    type: GitRepo
    configuration:
      files:
        include: ^front\/CI\/Docker\/.+
      path: cyan21/k8s-app
      branches:
        include: jfrog-ode
      gitProvider: yann_github
#  - name: aql_go
#    type: Aql
#    configuration:
#      sourceArtifactory: artifactory
#      query: items.find({"name":"backend","@build.name":"backapp_go_pipeline","@build.number":"43"})
#      query: items.find({"name":"backend"})

  - name: frontapp_npm_exec
    type: FileSpec
    configuration:
      sourceArtifactory: artifactory_eu
      pattern: avengers-generic/frontapp-2.0.3.tar.gz
      # buildName: ${triggerBuildInfoName}
      # buildNumber: ${triggerBuildInfoNumber}
      flat: true
#      pattern: app-generic/backend
#      aql: '{"name":"backend","@build.name":"backapp_go_pipeline","@build.number":"43"}'
#      aql: "({\"name\":\"backend\"})"

  - name: bi_k8s_frontapp_js_docker
    type: BuildInfo
    configuration:
      sourceArtifactory: artifactory_eu
      buildName: k8s_frontapp_js_docker
      buildNumber: '${run_number}'

  - name: bi_k8s_frontapp_js_docker_promoted_staging
    type: BuildInfo
    configuration:
      sourceArtifactory: artifactory_eu
      buildName: k8s_frontapp_js_docker
      buildNumber: '${run_number}'

  - name: pb_k8s_frontapp_docker
    type: PropertyBag
    configuration:
      newTag: XXX

# HELM PIPELINE
  - name: src_code_k8s_frontapp_chart
    type: GitRepo
    configuration:
      gitProvider: yann_github
      path: cyan21/k8s-helm
 
  - name: hc_my_app
    type: HelmChart
    configuration:
      sourceArtifactory: artifactory_eu
      repository: ninjavengers-helm
      chart: my-app
      version: 1.0.0