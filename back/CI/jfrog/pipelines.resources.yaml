resources:

# gradle PIPELINE
  - name: src_code_k8s_backapp_gradle
    type: GitRepo
    configuration:
      files:
        include: ^back\/.+
        exclude: ^back\/CI\/.+
      gitProvider: yann_github
      path: cyan21/k8s-app
      branches:
        include: jfrog-ode

  # Build info for the published gradle App
  - name: bi_k8s_backapp_gradle
    type: BuildInfo
    configuration:
      sourceArtifactory: artifactory_eu
      buildName: k8s_backapp_gradle
      buildNumber: ${run_number}
  
  - name: bi_k8s_backapp_gradle_promoted_staging
    type: BuildInfo
    configuration:
      sourceArtifactory: artifactory_eu
      buildName: k8s_backapp_gradle
      buildNumber: ${run_number}
  
  - name: pb_k8s_backapp_gradle
    type: PropertyBag
    configuration:
      biNumber: XXX

# DOCKER PIPELINE
  - name: src_dockerfile_k8s_backapp_gradle
    type: GitRepo
    configuration:
      files:
        include: ^back\/CI\/Docker\/.+
      gitProvider: yann_github
      path: cyan21/k8s-app
      branches:
        include: jfrog-ode

  - name: backapp_gradle_exec
    type: FileSpec
    configuration:
      sourceArtifactory: artifactory_eu
      pattern:  ${envVarGrdlPromoteRepo}/**/rest-service-${runVarAppVersion}.jar
      target: rest-service.jar
      flat: true

  - name: bi_k8s_backapp_gradle_docker
    type: BuildInfo
    configuration:
      sourceArtifactory: artifactory_eu
      buildName: k8s_backapp_gradle_docker
      buildNumber: ${run_number}

  - name: bi_k8s_backapp_gradle_docker_promoted_staging
    type: BuildInfo
    configuration:
      sourceArtifactory: artifactory_eu
      buildName: k8s_backapp_gradle_docker
      buildNumber: ${run_number}

  - name: pb_k8s_backapp_gradle_docker
    type: PropertyBag
    configuration:
      newTag: XXX

# HELM PIPELINE
  - name: src_code_k8s_backapp_chart
    type: GitRepo
    configuration:
      gitProvider: yann_github
      path: cyan21/k8s-app
      files:
        include: ^chart\/.+

  - name: hc_my_app_backapp_gradle
    type: HelmChart
    configuration:
      sourceArtifactory: artifactory_eu
      repository: kaivengers-helm
      chart: myapp
      version: 1.0.0